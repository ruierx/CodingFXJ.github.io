{
    "version": "https://jsonfeed.org/version/1",
    "title": "CodingFXJ'Blog • All posts by \"ajax\" tag",
    "description": "",
    "home_page_url": "https://CodingFXJ.github.io",
    "items": [
        {
            "id": "https://codingfxj.github.io/2021/06/16/AJAX/",
            "url": "https://codingfxj.github.io/2021/06/16/AJAX/",
            "title": "AJAX",
            "date_published": "2021-06-16T07:57:12.000Z",
            "content_html": "<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h3 id=\"ajax-的使用\"><a class=\"markdownIt-Anchor\" href=\"#ajax-的使用\">#</a> AJAX 的使用</h3>\n<p>Ajax 特点是 <code>无需刷新页面便可向服务器传输或读写数据</code></p>\n<h4 id=\"创建一个-ajax-对象\"><a class=\"markdownIt-Anchor\" href=\"#创建一个-ajax-对象\">#</a> 创建⼀个 ajax 对象</h4>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// IE9及以上</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest()</span><br><span class=\"line\"><span class=\"comment\">// IE9以下</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">&#x27;Mricosoft.XMLHTTP&#x27;</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"xmlhttprequest-对象属性描述\"><a class=\"markdownIt-Anchor\" href=\"#xmlhttprequest-对象属性描述\">#</a> XMLHttpRequest 对象属性描述</h4>\n<p><img src=\"AJAX.assets/20210621030002.png\" alt=\"\"></p>\n<h4 id=\"配置链接信息\"><a class=\"markdownIt-Anchor\" href=\"#配置链接信息\">#</a> 配置链接信息</h4>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//所有现代浏览器（IE7+、Firefox、Chrome、Safari 以及 Opera）均内建 XMLHttpRequest 对象。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest()</span><br><span class=\"line\"><span class=\"comment\">// xhr 对象中的 open ⽅法是来配置请求信息的</span></span><br><span class=\"line\"><span class=\"comment\">// 第⼀个参数是本次请求的请求⽅式 get / post / put / ...</span></span><br><span class=\"line\"><span class=\"comment\">// 第⼆个参数是本次请求的 url </span></span><br><span class=\"line\"><span class=\"comment\">// 第三个参数是本次请求是否异步，默认 true 表示异步，false 表示同步</span></span><br><span class=\"line\"><span class=\"comment\">// xhr.open(&#x27;请求⽅式&#x27;, &#x27;请求地址&#x27;, 是否异步)</span></span><br><span class=\"line\">xhr.open(<span class=\"string\">&#x27;get&#x27;</span>, <span class=\"string\">&#x27;./data.php&#x27;</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"发送请求\"><a class=\"markdownIt-Anchor\" href=\"#发送请求\">#</a> 发送请求</h4>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//如需将请求发送到服务器，我们使用 XMLHttpRequest 对象的 open() 和 send() 方法：</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest()</span><br><span class=\"line\">xhr.open(<span class=\"string\">&#x27;get&#x27;</span>, <span class=\"string\">&#x27;./data.php&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">// 使⽤ xhr 对象中的 send ⽅法来发送请求</span></span><br><span class=\"line\">xhr.send()</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>如果想要拿到响应，我们需要有两个前提条件</p>\n<ol>\n<li>本次 HTTP 请求是成功的，也就是我们下面要说的 http 状态码为 200 ~ 299</li>\n<li>ajax 对象也有自己的状态码，用来表示本次 ajax 请求中各个阶段</li>\n</ol>\n</blockquote>\n<h3 id=\"ajax-状态码\"><a class=\"markdownIt-Anchor\" href=\"#ajax-状态码\">#</a> AJAX 状态码</h3>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">readyState === <span class=\"number\">0</span> : 表示未初始化完成，也就是 open 方法还没有执行 </span><br><span class=\"line\">readyState === <span class=\"number\">1</span> : 表示配置信息已经完成，也就是执行完 open 之后 </span><br><span class=\"line\">readyState === <span class=\"number\">2</span> : 表示 send 方法已经执行完成</span><br><span class=\"line\">readyState === <span class=\"number\">3</span> : 表示正在解析响应内容</span><br><span class=\"line\">readyState === <span class=\"number\">4</span> : 表示响应内容已经解析完毕，可以在客户端使用了</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"http状态码\"><a class=\"markdownIt-Anchor\" href=\"#http状态码\">#</a> http 状态码</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">一个 ajax 对象中有一个成员叫做 xhr.status</span><br><span class=\"line\">这个成员就是记录本次请求的 http 状态码的 </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"readystatechange\"><a class=\"markdownIt-Anchor\" href=\"#readystatechange\">#</a> readyStateChange</h4>\n<p>监听 ajax 对象的 readyState 值改变的的行为，readyState 的值发生变化了，那么就会触发该事件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   <span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest() xhr.open(<span class=\"string\">&#x27;get&#x27;</span>, <span class=\"string\">&#x27;./data.php&#x27;</span>)</span><br><span class=\"line\">\txhr.send()</span><br><span class=\"line\">\txhr.onreadyStateChange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 每次 readyState 改变的时候都会触发该事件</span></span><br><span class=\"line\">\t<span class=\"comment\">// 我们就在这里判断 readyState 的值是不是到 4</span></span><br><span class=\"line\">\t<span class=\"comment\">// 并且 http 的状态码是不是 200 ~ 299</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (xhr.readyState === <span class=\"number\">4</span> &amp;&amp; <span class=\"regexp\">/^2\\d&#123;2|$/</span>.test(xhr.status)) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 这里表示验证通过</span></span><br><span class=\"line\">\t<span class=\"comment\">// 我们就可以获取服务端给我们响应的内容了 &#125;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><strong>GET 还是 POST 优缺点</strong></p>\n<p>无法使用缓存文件（更新服务器上的文件或数据库）<br>\n向服务器发送大量数据（POST 没有数据量限制）<br>\n发送包含未知字符的用户输入时，POST 比 GET 更稳定也更可靠</p>\n</blockquote>\n<h4 id=\"get请求\"><a class=\"markdownIt-Anchor\" href=\"#get请求\">#</a> get 请求</h4>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest()</span><br><span class=\"line\"><span class=\"comment\">// 直接在地址后面加一个 ?，然后以 key=value 的形式传递 // 两个数据之间以 &amp; 分割</span></span><br><span class=\"line\">xhr.open(<span class=\"string\">&#x27;get&#x27;</span>, <span class=\"string\">&#x27;./data.php?a=100&amp;b=200&#x27;</span>)</span><br><span class=\"line\">xhr.send()</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"post-请求\"><a class=\"markdownIt-Anchor\" href=\"#post-请求\">#</a> post 请求</h4>\n<p>参数是携带在请求体中的，所以不需要再 url 后面拼接</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest() xhr.open(<span class=\"string\">&#x27;post&#x27;</span>, <span class=\"string\">&#x27;./data.php&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">// 1. 创建 ajax 对象</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest()</span><br><span class=\"line\"><span class=\"comment\">// 2. 配置请求信息 xhr.open(‘GET’, ‘./test.php’, true)</span></span><br><span class=\"line\"><span class=\"comment\">// 3. 发送请求 xhr.send()</span></span><br><span class=\"line\"><span class=\"comment\">// 4. 接受响应 xhr.onload = function () &#123;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(xhr.responseText) &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"ajax封装\"><a class=\"markdownIt-Anchor\" href=\"#ajax封装\">#</a> AJAX 封装</h3>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;en&quot;&gt;</span><br><span class=\"line\">    &lt;head&gt;</span><br><span class=\"line\">        &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class=\"line\">        &lt;title&gt;Document&lt;/title&gt;</span><br><span class=\"line\">        &lt;script&gt;</span><br><span class=\"line\">            /*</span><br><span class=\"line\">                type 代表 请求方式</span><br><span class=\"line\">                url  代表 请求url路径</span><br><span class=\"line\">                data 代表 发送数据</span><br><span class=\"line\">                success 代表 下载数据成功以后执行的函数</span><br><span class=\"line\">                error   代表 下载数据失败以后执行的函数</span><br><span class=\"line\">            */</span><br><span class=\"line\">            function $ajax(&#123;type = &quot;get&quot;, url, data, success, error&#125;)&#123;</span><br><span class=\"line\">                var xhr = null;</span><br><span class=\"line\">                try&#123;</span><br><span class=\"line\">                    xhr = new XMLHttpRequest();</span><br><span class=\"line\">                &#125;catch(error)&#123;</span><br><span class=\"line\">                    xhr = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                </span><br><span class=\"line\">                if(type == &quot;get&quot; &amp;&amp; data)&#123;</span><br><span class=\"line\">                    url += &quot;?&quot; + querystring(data);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                xhr.open(type, url, true);</span><br><span class=\"line\"></span><br><span class=\"line\">                if(type == &quot;get&quot;)&#123;</span><br><span class=\"line\">                    xhr.send();</span><br><span class=\"line\">                &#125;else&#123;</span><br><span class=\"line\">                     //设置提交数据格式</span><br><span class=\"line\">                    xhr.setRequestHeader(&quot;content-type&quot;, &quot;application/x-www-form-urlencoded&quot;);</span><br><span class=\"line\">                    data ? xhr.send(querystring(data)) : xhr.send();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                xhr.onreadystatechange = function()&#123;</span><br><span class=\"line\">                    if(xhr.readyState == 4)&#123;</span><br><span class=\"line\">                        if(xhr.status == 200)&#123;</span><br><span class=\"line\">                            if(success)&#123;</span><br><span class=\"line\">                                success(xhr.responseText);</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;else&#123;</span><br><span class=\"line\">                            if(error)&#123;</span><br><span class=\"line\">                                error(&quot;Error：&quot; + xhr.status);</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            function querystring(obj)&#123;</span><br><span class=\"line\">                var str = &#x27;&#x27;;</span><br><span class=\"line\">                for(var attr in obj)&#123;</span><br><span class=\"line\">                    str += attr + &quot;=&quot; + obj[attr] + &quot;&amp;&quot;;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                return str.substring(0, str.length - 1);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            window.onload = function()&#123;</span><br><span class=\"line\">                var aBtns = document.getElementsByTagName(&quot;button&quot;);</span><br><span class=\"line\">                /*</span><br><span class=\"line\">                    当我们下载完数据以后需要对数据的处理方式不一样</span><br><span class=\"line\">                    【注】$ajax，我们需要按照传参的顺序，依次传入我们的参数。</span><br><span class=\"line\">                */</span><br><span class=\"line\"></span><br><span class=\"line\">                aBtns[0].onclick = function()&#123;</span><br><span class=\"line\">                    $ajax(&#123;</span><br><span class=\"line\">                        url: &quot;code14/1.get.php&quot;,</span><br><span class=\"line\">                        data: &#123;</span><br><span class=\"line\">                            username: &quot;小明&quot;,</span><br><span class=\"line\">                            age: 18,</span><br><span class=\"line\">                            password: &quot;123abc&quot;</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        success: function(result)&#123;</span><br><span class=\"line\">                            alert(&quot;GET请求到的数据：&quot; + result);</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        error: function(msg)&#123;</span><br><span class=\"line\">                            alert(&quot;GET请求数据错误：&quot; + msg);</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                aBtns[1].onclick = function()&#123;</span><br><span class=\"line\">                    $ajax(&#123;</span><br><span class=\"line\">                        type: &quot;post&quot;,</span><br><span class=\"line\">                        url: &quot;code14/2.post.php&quot;,</span><br><span class=\"line\">                        data: &#123;</span><br><span class=\"line\">                            username: &quot;小花&quot;,</span><br><span class=\"line\">                            age: 18,</span><br><span class=\"line\">                            password: &quot;123abc&quot;</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        success: function(result)&#123;</span><br><span class=\"line\">                            alert(&quot;POST请求到的数据：&quot; + result);</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        error: function(msg)&#123;</span><br><span class=\"line\">                            alert(&quot;POST请求数据错误：&quot; + msg);</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;/script&gt;</span><br><span class=\"line\">    &lt;/head&gt;</span><br><span class=\"line\">    &lt;body&gt;</span><br><span class=\"line\">        &lt;button&gt;GET请求&lt;/button&gt;</span><br><span class=\"line\">        &lt;button&gt;POST请求&lt;/button&gt;</span><br><span class=\"line\">    &lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "AJAX",
                "jQuery"
            ]
        }
    ]
}